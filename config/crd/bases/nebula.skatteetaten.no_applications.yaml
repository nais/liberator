
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.6.2
  creationTimestamp: null
  name: applications.nebula.skatteetaten.no
spec:
  group: nebula.skatteetaten.no
  names:
    kind: Application
    listKind: ApplicationList
    plural: applications
    shortNames:
    - nap
    singular: application
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - jsonPath: .status.synchronizationState
      name: State
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Application is the Schema for the applications API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: ApplicationSpec defines the desired state of Application
            properties:
              auroraApplication:
                description: Set this flag if the application is build onPrem, this
                  will add the default volume mounts an AuroraApplication requires
                type: boolean
              azure:
                description: Integratons this application has with Azure
                properties:
                  cosmosDb:
                    additionalProperties:
                      properties:
                        disabled:
                          description: Set this to true to disable
                          type: boolean
                        mongoDBVersion:
                          description: The version of MongoDB you want in your CosmodDB
                            api.
                          type: string
                        name:
                          description: the name of the cosmosdb
                          type: string
                        overridePrefix:
                          description: Override the generated prefix
                          type: string
                        primary:
                          description: If you specify multiple resources mark this
                            as the primary one.
                          type: boolean
                      required:
                      - name
                      type: object
                    description: 'CosmodDB databases in azure If a single cosmosdb
                      is configured it will be marked as primary by default The primary
                      cosmosdb with have the prefix SPRING_DATA_MONGODB if it has
                      mongodb or COSMOSDB if not All cosmosDb will have prefix SPRING_DATA_MONGODB_<NAME>
                      if mongodb or COSMODDB_<NAME> if not The env variables populated
                      are: - <PREFIX>_URI - <PREFIX>_DATABASE The prefix can be overwritten
                      if needed by setting overridePrefix'
                    type: object
                  postgresDatabase:
                    additionalProperties:
                      properties:
                        disabled:
                          type: boolean
                        name:
                          description: The name of the database. This is the logical
                            name in the config, the actual name in azure is generated
                            from this.
                          type: string
                        server:
                          description: The name of the server. For this to work there
                            needs to be a postgresqlserver provisioned in the namespace
                            with the name pgs-<namespace>-<server> Here namespace
                            is the name of the namespace this resource is in and server
                            is this name
                          type: string
                        users:
                          additionalProperties:
                            properties:
                              disabled:
                                description: Set this to true to disable
                                type: boolean
                              name:
                                description: The name of the user
                                type: string
                              overridePrefix:
                                description: Override the generated prefix
                                type: string
                              primary:
                                description: If you specify multiple resources mark
                                  this as the primary one.
                                type: boolean
                              role:
                                description: The role this user has in the database.
                                  Right now only "azure_pg_admin" is supported
                                type: string
                            required:
                            - name
                            - role
                            type: object
                          description: All the users that are in this postgres database
                          type: object
                      required:
                      - name
                      - server
                      - users
                      type: object
                    description: PostgresDatabases in azure using If a single database/user
                      is configured it will be marked as primary by default The primary
                      user will get env vars populated with the SPRING_DATASORUCE
                      prefix. Alle users will get env vars populated with a prefix
                      of SPRING_DATASOURCE_<USER> The variables populated are - <PREFIX>_URL
                      - <PREFIX>_USERNAME - <PREFIX>_PASSWORD The prefix can be overwritten
                      if needed by setting overridePrefix
                    type: object
                  resourceGroup:
                    description: The resource group in azure to provision resources
                      to. This field is required. This is the logical name of the
                      resource group and will be prefixed with a namepace to make
                      it global
                    type: string
                  storageAccount:
                    additionalProperties:
                      properties:
                        disabled:
                          description: Set this to true to disable
                          type: boolean
                        name:
                          description: The name of the storageaccount. This is the
                            logical name in the config, the actual name in azure is
                            generated from this.
                          type: string
                        overridePrefix:
                          description: Override the generated prefix
                          type: string
                        primary:
                          description: If you specify multiple resources mark this
                            as the primary one.
                          type: boolean
                      required:
                      - name
                      type: object
                    description: Storageaccounts in azure If a single storageaccount
                      is configured it will be marked as primary by default The primary
                      storageaccount with have the prefix AZURE_STORAGE All storageaccounts
                      will have prefix AZURE_STORAGE_<NAME> The env variables populated
                      are - <PREFIX>_CONNECTIONSTRING The prefix can be overwritten
                      if needed by setting overridePrefix
                    type: object
                required:
                - resourceGroup
                type: object
              egress:
                description: Configure zero-trust for outgoing trafix
                properties:
                  external:
                    additionalProperties:
                      properties:
                        disabled:
                          description: Set this to true to disable
                          type: boolean
                        host:
                          description: The hostname to allow traffic to
                          type: string
                        ports:
                          description: The ports to allow traffic to, the default
                            is HTTPS on port 443
                          items:
                            properties:
                              name:
                                description: Name of the port
                                type: string
                              port:
                                description: The port number
                                type: integer
                              protocol:
                                description: The protocol of the port
                                type: string
                            required:
                            - port
                            type: object
                          type: array
                      required:
                      - host
                      type: object
                    description: Zero-trust outgoing configuration for traffic going
                      out of the mesh
                    type: object
                  internal:
                    additionalProperties:
                      properties:
                        application:
                          description: The internal application to allow traffic to
                          type: string
                        disabled:
                          description: Set this to true to disable
                          type: boolean
                        namespace:
                          description: The internal namespace to allow traffic to
                          type: string
                        ports:
                          description: Ports to alloww traffic to
                          items:
                            properties:
                              name:
                                description: Name of the port
                                type: string
                              port:
                                description: The port number
                                type: integer
                              protocol:
                                description: The protocol of the port
                                type: string
                            required:
                            - port
                            type: object
                          type: array
                      type: object
                    description: Zero-trust outgoing configuration for traffic insde
                      the mesh
                    type: object
                type: object
              imagePolicy:
                description: If relelvent specify an ImagePolicy that will track a
                  given branch og semver range into a stream of releases you can subscribe
                  to
                properties:
                  branch:
                    description: Specify either Branch or Semver, not both The branch
                      you want to create this imagePolicy for. This will create a
                      stream of images that can be listened to
                    type: string
                  disabled:
                    description: Set this to true to disable
                    type: boolean
                  nameSuffix:
                    type: string
                  semver:
                    description: Specify either Branch or Semver, not both The semver
                      expression to create imagePolicy for. This will create a stream
                      of images that can be listened to see [flux documentation](https://fluxcd.io/docs/guides/image-update/)
                      for examples
                    type: string
                required:
                - nameSuffix
                type: object
              ingress:
                description: Configure zero-trust for incomming traficc
                properties:
                  internal:
                    additionalProperties:
                      properties:
                        application:
                          description: The application to limit traffic from
                          type: string
                        disabled:
                          description: Set this to true to disable this ingress rule
                          type: boolean
                        methods:
                          description: The HTTP verbs that are allowed
                          items:
                            type: string
                          type: array
                        namespace:
                          description: The namespace to limit traffic from
                          type: string
                        paths:
                          description: The paths that are affected by this rule
                          items:
                            type: string
                          type: array
                        ports:
                          description: The ports that are allowed to be called
                          items:
                            properties:
                              name:
                                description: Name of the port
                                type: string
                              port:
                                description: The port number
                                type: integer
                              protocol:
                                description: The protocol of the port
                                type: string
                            required:
                            - port
                            type: object
                          type: array
                      type: object
                    description: Zero-trust incomming configuration for traffic comming
                      from inside of the mesh
                    type: object
                  public:
                    additionalProperties:
                      properties:
                        disabled:
                          description: Set this to true to disable this ingress rule
                          type: boolean
                        gateway:
                          description: The ingress gateway to use. the default value
                            is 'istio-ingressgateway'
                          type: string
                        hostPrefix:
                          description: A prefix to use for the host part
                          type: string
                        overrideHostname:
                          description: Fully qualified host that can be set to override
                            host generation
                          type: string
                        port:
                          description: The port to use, the default value if not specified
                            is '8080'
                          type: integer
                        serviceport:
                          description: The port in the service to point to, the default
                            value if not specified is '80'
                          type: integer
                      type: object
                    description: Zero-trust incomming configuration for traffic comming
                      from outside of the mesh
                    type: object
                type: object
              pod:
                description: How the application pod of this application should run
                properties:
                  command:
                    description: The commands to send if any
                    items:
                      type: string
                    type: array
                  env:
                    description: Custom environment variables injected into your container.
                      Specify either `value` or `valueFrom`, but not both.
                    items:
                      properties:
                        name:
                          description: Environment variable name. May only contain
                            letters, digits, and the underscore `_` character.
                          type: string
                        value:
                          description: Environment variable value. Numbers and boolean
                            values must be quoted. Required unless `valueFrom` is
                            specified.
                          type: string
                        valueFrom:
                          description: Dynamically set environment variables based
                            on fields found in the Pod spec.
                          properties:
                            fieldRef:
                              properties:
                                fieldPath:
                                  description: Field value from the `Pod` spec that
                                    should be copied into the environment variable.
                                  enum:
                                  - ""
                                  - metadata.name
                                  - metadata.namespace
                                  - metadata.labels
                                  - metadata.annotations
                                  - spec.nodeName
                                  - spec.serviceAccountName
                                  - status.hostIP
                                  - status.podIP
                                  type: string
                              required:
                              - fieldPath
                              type: object
                          required:
                          - fieldRef
                          type: object
                      required:
                      - name
                      type: object
                    type: array
                  envFrom:
                    description: "EnvFrom exposes all variables in the ConfigMap or
                      Secret resources as environment variables. One of `configMap`
                      or `secret` is required. \n Environment variables will take
                      the form `KEY=VALUE`, where `key` is the ConfigMap or Secret
                      key. You can specify as many keys as you like in a single ConfigMap
                      or Secret. \n The ConfigMap and Secret resources must live in
                      the same Kubernetes namespace as the Application resource."
                    items:
                      properties:
                        configmap:
                          description: Name of the `ConfigMap` where environment variables
                            are specified. Required unless `secret` is set.
                          type: string
                        secret:
                          description: Name of the `Secret` where environment variables
                            are specified. Required unless `configMap` is set.
                          type: string
                      type: object
                    type: array
                  filesFrom:
                    description: "List of ConfigMap or Secret resources that will
                      have their contents mounted into the containers as files. Either
                      `configMap` or `secret` is required. \n Files will take the
                      path `<mountPath>/<key>`, where `key` is the ConfigMap or Secret
                      key. You can specify as many keys as you like in a single ConfigMap
                      or Secret, and they will all be mounted to the same directory.
                      \n The ConfigMap and Secret resources must live in the same
                      Kubernetes namespace as the Application resource."
                    items:
                      properties:
                        configmap:
                          description: Name of the `ConfigMap` that contains files
                            that should be mounted into the container. Required unless
                            `secret` or `persistentVolumeClaim` is set.
                          type: string
                        mountPath:
                          description: "Filesystem path inside the pod where files
                            are mounted. The directory will be created if it does
                            not exist. If the directory exists, any files in the directory
                            will be made unaccessible. \n Defaults to `/var/run/configmaps/<NAME>`,
                            `/var/run/secrets`, or `/var/run/pvc/<NAME>`, depending
                            on which of them is specified."
                          type: string
                        persistentVolumeClaim:
                          description: Name of the `PersistentVolumeClaim` that should
                            be mounted into the container. Required unless `configMap`
                            or `secret` is set. This feature requires coordination
                            with the NAIS team.
                          type: string
                        secret:
                          description: Name of the `Secret` that contains files that
                            should be mounted into the container. Required unless
                            `configMap` or `persistentVolumeClaim` is set. If mounting
                            multiple secrets, `mountPath` *MUST* be set to avoid collisions.
                          type: string
                      type: object
                    type: array
                  imageName:
                    description: The image to run for this pod
                    type: string
                  liveness:
                    description: Many applications running for long periods of time
                      eventually transition to broken states, and cannot recover except
                      by being restarted. Kubernetes provides liveness probes to detect
                      and remedy such situations. Read more about this over at the
                      [Kubernetes probes documentation](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/).
                    properties:
                      failureThreshold:
                        description: When a Pod starts, and the probe fails, Kubernetes
                          will try _failureThreshold_ times before giving up. Giving
                          up in case of a startup probe means restarting the Pod.
                        type: integer
                      initialDelay:
                        description: Number of seconds after the container has started
                          before startup probes are initiated.
                        type: integer
                      path:
                        description: HTTP endpoint path that signals 200 OK if the
                          application has started successfully.
                        type: string
                      periodSeconds:
                        description: How often (in seconds) to perform the probe.
                        type: integer
                      port:
                        description: Port for the startup probe.
                        type: integer
                      timeout:
                        description: Number of seconds after which the probe times
                          out.
                        type: integer
                    required:
                    - path
                    type: object
                  minAvailable:
                    default: 1
                    description: Minimum available pods for PodDisruptionBudget, default
                      is 1
                    format: int32
                    type: integer
                  prometheus:
                    description: Prometheus is used to [scrape metrics from the pod](https://doc.nais.io/observability/metrics/).
                      Use this configuration to override the default values.
                    properties:
                      disabled:
                        description: Set this to true to disable
                        type: boolean
                      path:
                        default: /metrics
                        description: Set the path metrics are exposed on. Default
                          is '/metrics'
                        type: string
                      port:
                        default: "8080"
                        description: Set the port you want to expose metrics on. Default
                          is '8080'
                        type: string
                    type: object
                  readiness:
                    description: Sometimes, applications are temporarily unable to
                      serve traffic. For example, an application might need to load
                      large data or configuration files during startup, or depend
                      on external services after startup. In such cases, you don't
                      want to kill the application, but you don’t want to send it
                      requests either. Kubernetes provides readiness probes to detect
                      and mitigate these situations. A pod with containers reporting
                      that they are not ready does not receive traffic through Kubernetes
                      Services. Read more about this over at the [Kubernetes readiness
                      documentation](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/).
                    properties:
                      failureThreshold:
                        description: When a Pod starts, and the probe fails, Kubernetes
                          will try _failureThreshold_ times before giving up. Giving
                          up in case of a startup probe means restarting the Pod.
                        type: integer
                      initialDelay:
                        description: Number of seconds after the container has started
                          before startup probes are initiated.
                        type: integer
                      path:
                        description: HTTP endpoint path that signals 200 OK if the
                          application has started successfully.
                        type: string
                      periodSeconds:
                        description: How often (in seconds) to perform the probe.
                        type: integer
                      port:
                        description: Port for the startup probe.
                        type: integer
                      timeout:
                        description: Number of seconds after which the probe times
                          out.
                        type: integer
                    required:
                    - path
                    type: object
                  resources:
                    description: When Containers have [resource requests](http://kubernetes.io/docs/user-guide/compute-resources/)
                      specified, the Kubernetes scheduler can make better decisions
                      about which nodes to place pods on.
                    properties:
                      limits:
                        description: Limit defines the maximum amount of resources
                          a container can use before getting evicted.
                        properties:
                          cpu:
                            pattern: ^\d+m?$
                            type: string
                          memory:
                            pattern: ^\d+[KMG]i$
                            type: string
                        type: object
                      requests:
                        description: Request defines the amount of resources a container
                          is allocated on startup.
                        properties:
                          cpu:
                            pattern: ^\d+m?$
                            type: string
                          memory:
                            pattern: ^\d+[KMG]i$
                            type: string
                        type: object
                    type: object
                  startup:
                    description: Kubernetes uses startup probes to know when a container
                      application has started. If such a probe is configured, it disables
                      liveness and readiness checks until it succeeds, making sure
                      those probes don't interfere with the application startup. This
                      can be used to adopt liveness checks on slow starting containers,
                      avoiding them getting killed by Kubernetes before they are up
                      and running.
                    properties:
                      failureThreshold:
                        description: When a Pod starts, and the probe fails, Kubernetes
                          will try _failureThreshold_ times before giving up. Giving
                          up in case of a startup probe means restarting the Pod.
                        type: integer
                      initialDelay:
                        description: Number of seconds after the container has started
                          before startup probes are initiated.
                        type: integer
                      path:
                        description: HTTP endpoint path that signals 200 OK if the
                          application has started successfully.
                        type: string
                      periodSeconds:
                        description: How often (in seconds) to perform the probe.
                        type: integer
                      port:
                        description: Port for the startup probe.
                        type: integer
                      timeout:
                        description: Number of seconds after which the probe times
                          out.
                        type: integer
                    required:
                    - path
                    type: object
                  tag:
                    description: '` tag: 0.8.3 # {"$imagepolicy": "example:supernova-0.x:tag"}`
                      where the `0.x` part is the spec.imagePolicy.policySuffix stream
                      you want to follow'
                    type: string
                required:
                - imageName
                - tag
                type: object
              replicas:
                description: The number of replicas to start with and maxReplicas
                  to scale to using HPA
                properties:
                  cpuThresholdPercentage:
                    description: Amount of CPU usage before the autoscaler kicks in.
                    type: integer
                  disableAutoScaling:
                    description: Disable autoscaling
                    type: boolean
                  max:
                    description: The pod autoscaler will increase replicas when required
                      up to the maximum.
                    type: integer
                  min:
                    description: The minimum amount of running replicas for a deployment.
                    type: integer
                type: object
              unsecuredebugdisableallaccesspolicies:
                description: Flag to disable all zero-trust configuration to debug
                type: boolean
            required:
            - pod
            type: object
          status:
            description: Status contains different NAIS status properties
            properties:
              conditions:
                items:
                  description: "Condition contains details for one aspect of the current
                    state of this API Resource. --- This struct is intended for direct
                    use as an array at the field path .status.conditions.  For example,
                    type FooStatus struct{     // Represents the observations of a
                    foo's current state.     // Known .status.conditions.type are:
                    \"Available\", \"Progressing\", and \"Degraded\"     // +patchMergeKey=type
                    \    // +patchStrategy=merge     // +listType=map     // +listMapKey=type
                    \    Conditions []metav1.Condition `json:\"conditions,omitempty\"
                    patchStrategy:\"merge\" patchMergeKey:\"type\" protobuf:\"bytes,1,rep,name=conditions\"`
                    \n     // other fields }"
                  properties:
                    lastTransitionTime:
                      description: lastTransitionTime is the last time the condition
                        transitioned from one status to another. This should be when
                        the underlying condition changed.  If that is not known, then
                        using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: message is a human readable message indicating
                        details about the transition. This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: observedGeneration represents the .metadata.generation
                        that the condition was set based upon. For instance, if .metadata.generation
                        is currently 12, but the .status.conditions[x].observedGeneration
                        is 9, the condition is out of date with respect to the current
                        state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: reason contains a programmatic identifier indicating
                        the reason for the condition's last transition. Producers
                        of specific condition types may define expected values and
                        meanings for this field, and whether the values are considered
                        a guaranteed API. The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                        --- Many .condition.type values are consistent across resources
                        like Available, but because arbitrary conditions can be useful
                        (see .node.status.conditions), the ability to deconflict is
                        important. The regex it matches is (dns1123SubdomainFmt/)?(qualifiedNameFmt)
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              correlationID:
                type: string
              deploymentRolloutStatus:
                type: string
              rolloutCompleteTime:
                format: int64
                type: integer
              synchronizationHash:
                type: string
              synchronizationState:
                type: string
              synchronizationTime:
                format: int64
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
